from unittest.mock import patch, MagicMock
import unittest
from lxml import etree

from kpsv2_client.service import KpsService, KpsException


class TestKpsService(unittest.TestCase):
    def setUp(self):
        self.kps_service = KpsService()

    def test_set_auth(self):
        self.kps_service.set_auth("username", "password")
        self.assertEqual(self.kps_service._username, "username")
        self.assertEqual(self.kps_service._password, "password")

    def test_check_auth_without_auth(self):
        with self.assertRaises(KpsException):
            self.kps_service._check_auth()

    def test_check_auth_with_auth(self):
        self.kps_service.set_auth("username", "password")
        try:
            self.kps_service._check_auth()
        except KpsException:
            self.fail("_check_auth() raised KpsException unexpectedly!")

    @patch('kpsv2_client.service.requests.post')
    def test_bilesik_kutuk_sorgula(self, mock_post):
        mock_response = MagicMock()
        mock_response.content.decode.return_value = '<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://www.w3.org/2005/08/addressing" xmlns:u="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"><s:Header><a:Action s:mustUnderstand="1">http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTRC/IssueFinal</a:Action><a:RelatesTo>urn:uuid:9d780aca-77e6-47b1-acf6-4c7c4d94bb25</a:RelatesTo><o:Security s:mustUnderstand="1" xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><u:Timestamp u:Id="_0"><u:Created>2024-05-30T10:03:54.109Z</u:Created><u:Expires>2024-05-30T10:08:54.109Z</u:Expires></u:Timestamp></o:Security></s:Header><s:Body><trust:RequestSecurityTokenResponseCollection xmlns:trust="http://docs.oasis-open.org/ws-sx/ws-trust/200512"><trust:RequestSecurityTokenResponse><trust:KeySize>256</trust:KeySize><trust:Lifetime><wsu:Created xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">2024-05-30T10:03:54.109Z</wsu:Created><wsu:Expires xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">2024-05-30T11:03:54.109Z</wsu:Expires></trust:Lifetime><wsp:AppliesTo xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"><a:EndpointReference><a:Address>https://kpsv2test.nvi.gov.tr/Services/RoutingService.svc</a:Address></a:EndpointReference></wsp:AppliesTo><trust:RequestedSecurityToken><xenc:EncryptedData Type="http://www.w3.org/2001/04/xmlenc#Element" xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"><xenc:EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes256-cbc"/><KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#"><e:EncryptedKey xmlns:e="http://www.w3.org/2001/04/xmlenc#"><e:EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p"><DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/></e:EncryptionMethod><KeyInfo><o:SecurityTokenReference xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><X509Data><X509IssuerSerial><X509IssuerName>CN=MERNISSUBCA02, DC=mernis, DC=intra</X509IssuerName><X509SerialNumber>535217885312034837035320232220865626495778921</X509SerialNumber></X509IssuerSerial></X509Data></o:SecurityTokenReference></KeyInfo><e:CipherData><e:CipherValue>eZ0iiH9TK5bEjKd1I5y11dC3kZl/uILeYfWCB/UMcN1CWtmB0NWcCrZjGcGS3w9+UeQz5sIX2T6d/h5gjwewdQdYSwTSqUDQfjTP9trXi9skHgHMwVJgd+qdrnkQBQ/oILMuNhznerOTM5OtZcaj1GYUHtci4ofUjWEm4sYxX4XD6ErWwMs+t06lXFeZuBBCQ/RyKLhX6w68QSadoHlpSPUjW2AQByAsJ5jPJ3RkatJgfaFLA8sM/qtcODbm2L9wXYw/kBOkdYy3+JQT3mvaejoASwSE07wRz7Pgh8MZYEHWTX0JJfz71vcMfSt6VYJmxE8J2hzmsdtKB91pw/Xjig==</e:CipherValue></e:CipherData></e:EncryptedKey></KeyInfo><xenc:CipherData><xenc:CipherValue>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</xenc:CipherValue></xenc:CipherData></xenc:EncryptedData></trust:RequestedSecurityToken><trust:RequestedProofToken><trust:BinarySecret>oxD2EEeIaei5ydlKUjacBumUcief1cqN1BdyGSmN+2o=</trust:BinarySecret></trust:RequestedProofToken><trust:RequestedAttachedReference><o:SecurityTokenReference k:TokenType="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1" xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:k="http://docs.oasis-open.org/wss/oasis-wss-wssecurity-secext-1.1.xsd"><o:KeyIdentifier ValueType="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0#SAMLAssertionID">_99c8ea68-d169-412a-9d83-0c882a6eaf63</o:KeyIdentifier></o:SecurityTokenReference></trust:RequestedAttachedReference><trust:RequestedUnattachedReference><o:SecurityTokenReference k:TokenType="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1" xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:k="http://docs.oasis-open.org/wss/oasis-wss-wssecurity-secext-1.1.xsd"><o:KeyIdentifier ValueType="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0#SAMLAssertionID">_99c8ea68-d169-412a-9d83-0c882a6eaf63</o:KeyIdentifier></o:SecurityTokenReference></trust:RequestedUnattachedReference><trust:TokenType>urn:oasis:names:tc:SAML:1.0:assertion</trust:TokenType><trust:RequestType>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Issue</trust:RequestType><trust:KeyType>http://docs.oasis-open.org/ws-sx/ws-trust/200512/SymmetricKey</trust:KeyType></trust:RequestSecurityTokenResponse></trust:RequestSecurityTokenResponseCollection></s:Body></s:Envelope>'
        soap_response = etree.fromstring(mock_response.content.decode.return_value.encode('utf-8'))

        envelope = soap_response.find('{http://www.w3.org/2003/05/soap-envelope}Body')
        body = envelope.getchildren()[0]

        namespaces = {
            'trust': 'http://docs.oasis-open.org/ws-sx/ws-trust/200512',
            'wsu': 'http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd'
        }

        key_size = int(body.find('.//trust:KeySize', namespaces).text)

        created_time = body.find('.//wsu:Created', namespaces).text
        expires_time = body.find('.//wsu:Expires', namespaces).text

        self.assertEqual(key_size, 256)
        self.assertEqual(created_time, '2024-05-30T10:03:54.109Z')
        self.assertEqual(expires_time, '2024-05-30T11:03:54.109Z')

if __name__ == '__main__':
    unittest.main()
